<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Password Request Batch 4-JV</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  padding: 20px;
}
.container {
  max-width: 420px;
  margin: auto;
  background: #ffffff;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
h2 { text-align: center; }
label { font-weight: bold; }

input[type="text"], input[type="tel"] {
  width: 100%;
  padding: 10px;
  margin: 5px 0 15px;
  border: 1px solid #ccc;
  border-radius: 5px;
  text-transform: uppercase;
}

.consent {
  font-size: 13px;
  margin-bottom: 15px;
}

button {
  width: 100%;
  padding: 12px;
  background: #25D366;
  color: white;
  border: none;
  border-radius: 5px;
  font-size: 16px;
  cursor: not-allowed;
  opacity: 0.6;
}
button.enabled {
  cursor: pointer;
  opacity: 1;
}

.note {
  font-size: 12px;
  color: #666;
  text-align: center;
  margin-top: 10px;
}

.statusIcon {
  text-align: center;
  margin-bottom: 15px;
}

.ref {
  font-weight: bold;
  margin-top: 10px;
}

.trademark {
  text-align: center;
  font-size: 11px;
  color: #999;
  margin-top: 25px;
}
</style>

<script>
var IS_SUBMITTED = false;
</script>
</head>

<body>

<!-- FORM -->
<div class="container" id="formBox">
  <h2>üîê Password Request Batch 5-JV</h2>

  <form onsubmit="return validateAndSend();">
    <label>Company Name</label>
    <input type="text" id="company" required>

    <label>Director Name</label>
    <input type="text" id="director" required>

    <label>Company Reg. No</label>
    <input type="text" id="regno" required>

    <label>Contact No</label>
    <input type="tel" id="phone" placeholder="e.g. 0123456789" required>

    <div class="consent">
      <input type="checkbox" id="consent" onclick="toggleButton()">
      By submitting this request, I acknowledge that I am requesting access to a
      password issued by SINGER (M) SDN BHD / BERJAYA CREDIT SDN BHD and accept full
      responsibility for its use. Unauthorized access or misuse may result in further
      action.
    </div>

    <button type="submit" id="sendBtn" disabled>Send Request</button>
  </form>

  <div class="note">Request will be sent via WhatsApp</div>
</div>

<!-- SUCCESS PAGE (SAMA SEPERTI ASAL) -->
<div class="container" id="successBox" style="display:none;text-align:center;">
  <div class="statusIcon">üìÑ</div>

  <h2>Request Prepared</h2>

  <div class="ref" id="refDisplay"></div>

  <p style="font-size:12px;color:#666;">
    Reference number is for tracking purposes only.
  </p>

  <p>
    WhatsApp has been opened with your request details.<br><br>
    <b>Please tap ‚ÄúSend‚Äù in WhatsApp to complete this request.</b><br><br>
    After sending, you may safely close this page.
  </p>
</div>

<div class="trademark" id="trademark"></div>

<script>
function toggleButton() {
  var btn = document.getElementById("sendBtn");
  btn.disabled = !document.getElementById("consent").checked;
  btn.classList.toggle("enabled", !btn.disabled);
}

function generateReference() {
  var d = new Date();
  return "JV5-" +
    d.getFullYear() +
    String(d.getMonth()+1).padStart(2,"0") +
    String(d.getDate()).padStart(2,"0") + "-" +
    String(d.getHours()).padStart(2,"0") +
    String(d.getMinutes()).padStart(2,"0") +
    String(d.getSeconds()).padStart(2,"0");
}

function validateAndSend() {
  if (IS_SUBMITTED) return false;

  var phone = document.getElementById("phone").value.trim();
  if (!/^\d{10,15}$/.test(phone)) {
    alert("Please enter valid phone number (digits only).");
    return false;
  }

  if (!document.getElementById("consent").checked) return false;

  IS_SUBMITTED = true;
  document.getElementById("sendBtn").innerText = "Preparing...";

  sendWhatsApp();
  return false;
}

function sendWhatsApp() {

  var company = document.getElementById("company").value.toUpperCase();
  var director = document.getElementById("director").value.toUpperCase();
  var regno = document.getElementById("regno").value.toUpperCase();
  var phone = document.getElementById("phone").value;
  var ref = generateReference();
  var time = new Date().toLocaleString();

  var data = new FormData();
  data.append("time", time);
  data.append("company", company);
  data.append("director", director);
  data.append("regno", regno);
  data.append("phone", phone);
  data.append("ref", ref);
  data.append("ua", navigator.userAgent);
  data.append("platform", navigator.platform);
  data.append("lang", navigator.language);

  fetch("https://script.google.com/macros/s/AKfycbzDuhYWeSeS_rh799_SS9KU1gmhaR0KpXkOstaTto8111hYuWgA3i9hy2eHbp0n4FLJ/exec", {
    method: "POST",
    body: data
  })
  .then(r => r.json())
  .then(res => {

    // ‚ùå DUPLICATE ‚Üí STOP SEMUA
    if (res.status === "DUPLICATE") {
      alert("‚ö†Ô∏è Request has already been submitted previously.\n\nPlease contact the administrator.");

      IS_SUBMITTED = false;
      var btn = document.getElementById("sendBtn");
      btn.innerText = "Send Request";
      btn.disabled = false;
      return;
    }

    // ‚ùå ERROR
    if (res.status !== "OK") {
      alert("Submission failed. Please try again.");
      IS_SUBMITTED = false;
      return;
    }

    // ‚úÖ ONLY NOW OPEN WHATSAPP
    var msg =
      "üîê PASSWORD REQUEST BATCH 5-JV\n\n" +
      "Time: " + time + "\n\n" +
      "Company: " + company + "\n" +
      "Director: " + director + "\n" +
      "Reg No: " + regno + "\n" +
      "Contact: " + phone + "\n\n" +
      "Ref No: " + ref;

    window.open(
      "https://wa.me/60176701984?text=" + encodeURIComponent(msg),
      "_blank"
    );

    document.getElementById("formBox").style.display = "none";
    document.getElementById("successBox").style.display = "block";
    document.getElementById("refDisplay").innerText = "Reference No: " + ref;

  })
  .catch(() => {
    alert("Network error. Please try again.");
    IS_SUBMITTED = false;
  });
}


function logToGoogleSheet(time, company, director, regno, phone, ref) {

  var data = new FormData();
  data.append("time", time);
  data.append("company", company);
  data.append("director", director);
  data.append("regno", regno);
  data.append("phone", phone);
  data.append("ref", ref);
  data.append("ua", navigator.userAgent);
  data.append("platform", navigator.platform);
  data.append("lang", navigator.language);

  fetch("https://script.google.com/macros/s/AKfycbysH9fDrsqHgfo4fZb-cbZB2erobpSjJOzcGekkR82Qrr_tmYOGBn74A_gVo2lFn60Q/exec", {
    method: "POST",
    body: data
  })
  .then(r => r.json())
  .then(res => {

    if (res.status === "DUPLICATE") {
      alert("‚ö†Ô∏è Request already submitted.\n\nThis agency has made a request previously.");

      IS_SUBMITTED = false;
      document.getElementById("sendBtn").innerText = "Send Request";
      document.getElementById("sendBtn").disabled = false;

      document.getElementById("successBox").style.display = "none";
      document.getElementById("formBox").style.display = "block";
    }

  })
  .catch(function(){});
}


(function () {
  var year = new Date().getFullYear();
  var domain = window.location.hostname || "yourdomain.com";
  document.getElementById("trademark").innerText =
    "¬© " + year + " " + domain + " ¬∑ Authorized Access Only";
})();
</script>

</body>
</html>



