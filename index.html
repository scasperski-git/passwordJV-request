<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Password Request Batch 5-JV</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  padding: 20px;
}

.container {
  max-width: 420px;
  margin: auto;
  background: #ffffff;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  position: relative;
}

.blur {
  filter: blur(3px);
  pointer-events: none;
}

h2 { text-align: center; }
label { font-weight: bold; }

input[type="text"], input[type="tel"] {
  width: 100%;
  padding: 10px;
  margin: 5px 0 5px;
  border: 1px solid #ccc;
  border-radius: 5px;
  text-transform: uppercase;
}

input.invalid { border-color: #d93025; }

.error {
  color: #d93025;
  font-size: 12px;
  margin-bottom: 10px;
  display: none;
}

.consent { font-size: 13px; margin-bottom: 15px; }

button {
  width: 100%;
  padding: 12px;
  background: #25D366;
  color: white;
  border: none;
  border-radius: 5px;
  font-size: 16px;
  cursor: not-allowed;
  opacity: 0.6;
}
button.enabled { cursor: pointer; opacity: 1; }

.note {
  font-size: 12px;
  color: #666;
  text-align: center;
  margin-top: 10px;
}

#overlay {
  position: fixed;
  inset: 0;
  background: rgba(255,255,255,0.75);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 999;
}

.spinner {
  border: 4px solid #ddd;
  border-top: 4px solid #25D366;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

.trademark {
  text-align: center;
  font-size: 11px;
  color: #999;
  margin-top: 25px;
}
</style>
</head>

<body>

<div id="overlay">
  <div style="text-align:center">
    <div class="spinner"></div>
    <p><b>Processing‚Ä¶</b><br>Sending request to WhatsApp</p>
  </div>
</div>

<div class="container" id="formBox">
<h2>üîê Password Request Batch 5-JV</h2>

<form onsubmit="return validateAndSend();">
<label>Company Name</label>
<input id="company" placeholder="e.g. ABC COLLECTION SDN BHD">
<div class="error" id="errCompany">All fields are required</div>

<label>Director Name</label>
<input id="director" placeholder="e.g. AHMAD BIN ALI">
<div class="error" id="errDirector">All fields are required</div>

<label>Company Reg. No</label>
<input id="regno" placeholder="e.g. 123456-A or 2025123265564">
<div class="error" id="errRegno">All fields are required</div>

<label>Contact No</label>
<input type="tel" id="phone" inputmode="numeric" placeholder="e.g. 012-3456789">
<div class="error" id="errPhone">Phone number must start with 0</div>

<div class="consent">
<input type="checkbox" id="consent" onclick="toggleButton()">
By submitting this request, I acknowledge that I am requesting access to a
password issued by SINGER (M) SDN BHD / BERJAYA CREDIT SDN BHD and accept full
responsibility for its use. Unauthorized access or misuse may result in further
action.
</div>

<button id="sendBtn" disabled>Send Request</button>
</form>

<div class="note">Request will be sent via WhatsApp</div>
</div>

<div class="container" id="successBox" style="display:none;">
<h2 style="text-align:center;">Request Prepared</h2>

<div id="summaryBox" style="border:1px solid #ddd;border-radius:8px;padding:15px;font-size:13px;background:#fafafa"></div>

<p style="font-size:12px;color:#666;text-align:center;margin-top:10px;">
Reference number is for tracking purposes only.
</p>

<p style="text-align:center;">
Please tap <b>Send</b> in WhatsApp to complete this request.
</p>
</div>

<div class="trademark" id="trademark"></div>

<script>
var IS_SUBMITTED=false;
var phoneInput=document.getElementById("phone");

phoneInput.addEventListener("input",()=>{
  var d=phoneInput.value.replace(/\D/g,"");
  phoneInput.value=d.length>3?d.slice(0,3)+"-"+d.slice(3,11):d;
  if(d && !d.startsWith("0")){errPhone.style.display="block";phoneInput.classList.add("invalid")}
  else{errPhone.style.display="none";phoneInput.classList.remove("invalid")}
});

function toggleButton(){
  sendBtn.disabled=!consent.checked;
  sendBtn.classList.toggle("enabled",!sendBtn.disabled);
}

function validateAndSend(){
  if(IS_SUBMITTED)return false;
  IS_SUBMITTED=true;
  overlay.style.display="flex";
  sendWhatsApp();
  return false;
}

<script>
function sendWhatsApp() {

  var company = companyVal();
  var director = directorVal();
  var regno = regnoVal();
  var phone = phoneVal();
  var ref = generateReference();
  var time = new Date().toLocaleString();

  var consentText =
    "By submitting this request, I acknowledge that I am requesting access to a " +
    "password issued by SINGER (M) SDN BHD / BERJAYA CREDIT SDN BHD and accept full " +
    "responsibility for its use. Unauthorized access or misuse may result in further action.";

  // ===== SEND TO APPS SCRIPT (KEKAL) =====
  var data = new FormData();
  data.append("time", time);
  data.append("company", company);
  data.append("director", director);
  data.append("regno", regno);
  data.append("phone", phone);
  data.append("ref", ref);
  data.append("ua", navigator.userAgent);
  data.append("platform", navigator.platform);
  data.append("lang", navigator.language);

  fetch("https://script.google.com/macros/s/AKfycbzRyXGi1ewQNvzk3hQSmmKSUkOS0-wMbaMUFgetZeYqqoF97Bjc-gfX1Gq4H5ZKp2A2/exec", {
    method: "POST",
    body: data
  })
  .then(r => r.json())
  .then(res => {

    // ‚ùå DUPLICATE / ERROR
    if (res.status !== "OK") {
      alert("Request already submitted or error occurred.");
      IS_SUBMITTED = false;
      showOverlay(false);
      return;
    }

    // ===== WHATSAPP MESSAGE (DENGAN CONSENT) =====
    var msg =
      "üîê PASSWORD REQUEST BATCH 5-JV\n\n" +
      "Time: " + time + "\n\n" +
      "Company: " + company + "\n" +
      "Director: " + director + "\n" +
      "Reg No: " + regno + "\n" +
      "Contact: " + phone + "\n\n" +
      "Consent:\n" + consentText + "\n\n" +
      "Ref No: " + ref;

    window.open(
      "https://wa.me/60176701984?text=" + encodeURIComponent(msg),
      "_blank"
    );

    // ===== SUCCESS SUMMARY =====
    document.getElementById("summaryBox").innerHTML =
      "<b>Company Name:</b> " + company + "<br><br>" +
      "<b>Director Name:</b> " + director + "<br><br>" +
      "<b>Company Reg. No:</b> " + regno + "<br><br>" +
      "<b>Contact No:</b> " + phone + "<br><br>" +
      "<b>Reference No:</b> " + ref + "<br><hr>" +
      "<b>Consent:</b><br>" + consentText;

    document.getElementById("formBox").style.display = "none";
    document.getElementById("successBox").style.display = "block";
    showOverlay(false);
  })
  .catch(() => {
    alert("Network error. Please try again.");
    IS_SUBMITTED = false;
    showOverlay(false);
  });
}
</script>


trademark.innerText="¬© "+new Date().getFullYear()+" ¬∑ Authorized Access Only";
</script>

</body>
</html>
